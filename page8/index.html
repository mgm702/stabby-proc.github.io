<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><default html>

    
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Stabby Proc · Taking a stab at this thing called blogging!
    
  </title>

  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/master/devicon.min.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  <link rel="alternate" type="application/atom+xml" title="Stabby Proc" href="/atom.xml">


  
    <div class="container content">
      <header class="masthead">
        <h2 class="masthead-title">
          <a href="/" title="Home">
            <img src="/public/stabby-proc-logo.png">
          </a>
        </h2>
        <span class="tagline">- "Taking a stab at this thing called blogging!"</span>
      </header>

      <main>
      <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ruby/array-first-last-in-cruby-part1.html">
        Array's First and Last method in CRuby Source Code - Part 1
      </a>
    </h1>

    <sub class="article-date">Feb-23-2017</sub>
    <p>The first area of Ruby source code that I want to discuss is the array data structure. The reason I want to begin with array data structure is because of the similar nature in which C and Ruby arrays operate. It’s also fascinating to see how C data structures are used and transformed in order to provide helper functions in Ruby that aren’t built into the core of C programming. However, before talking about the functions in Ruby, we first have to discuss how arrays are represented in MRI.</p>

<p>in CRuby, the <code class="highlighter-rouge">RArray</code> structure is used to represent each array you create in Ruby. Similar to other C structures in MRI, <code class="highlighter-rouge">RArray</code> holds the RBasic inner structure. This structure holds the klass pointer and other information necessary for object creation. In addition to basic object values, <code class="highlighter-rouge">RArray</code> holds important information about array allocation and management. Some of these values include the long variable <code class="highlighter-rouge">len</code>, which holds the number of values saved to the array, <code class="highlighter-rouge">ptr</code>, which is a pointer to a memory segment CRuby allocates individually in order to save array elements, and <code class="highlighter-rouge">shared</code>, which represents data that is consolidated between multiple arrays. All of these can be seen below in the <code class="highlighter-rouge">RArray</code> structure definition which can be found in your <code class="highlighter-rouge">ruby.h</code> file:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">RArray</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">RBasic</span> <span class="n">basic</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="kt">long</span> <span class="n">len</span><span class="p">;</span>
	    <span class="k">union</span> <span class="p">{</span>
		<span class="kt">long</span> <span class="n">capa</span><span class="p">;</span>
		<span class="n">VALUE</span> <span class="n">shared</span><span class="p">;</span>
	    <span class="p">}</span> <span class="n">aux</span><span class="p">;</span>
	    <span class="k">const</span> <span class="n">VALUE</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">heap</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">VALUE</span> <span class="n">ary</span><span class="p">[</span><span class="n">RARRAY_EMBED_LEN_MAX</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">as</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Now that you have an understanding about how the array object is created in Ruby, we can now talk about how CRuby creates the functions that make Ruby such an amazing language. I’ve decided that the first two methods I’m going to look at are simple and useful for finding elements in an array, <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-first">Array#first</a> and <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-last">Array#last</a>. Both of these functions are easy to understand in terms of their purpose and how to implement them. However, I can’t tell you how many times throughout my day I use these methods when working with array objects. They are functions that Ruby programmers take for granted so let’s take a look at how these functions are implemented under the hood.</p>

<p>The first thing I did in order to <a href="http://stabbyproc.com/ruby/tools-being-used-for-c-ruby-inspection.html">inspect these functions was open up the pry REPL program</a> and use the <code class="highlighter-rouge">show-source</code> method. I was able to pull both methods from the source code and they’re both shown below:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">source</span> <span class="n">Array</span><span class="err">#</span><span class="n">last</span>

<span class="n">From</span><span class="o">:</span> <span class="n">array</span><span class="p">.</span><span class="n">c</span> <span class="p">(</span><span class="n">C</span> <span class="n">Method</span><span class="p">)</span><span class="o">:</span>
<span class="n">Owner</span><span class="o">:</span> <span class="n">Array</span>
<span class="n">Visibility</span><span class="o">:</span> <span class="n">public</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="o">:</span> <span class="mi">12</span>

<span class="n">VALUE</span> <span class="n">rb_ary_last</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="n">VALUE</span> <span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">ary</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">Qnil</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">RARRAY_AREF</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ary_take_first_or_last</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">ary</span><span class="p">,</span> <span class="n">ARY_TAKE_LAST</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And here’s the <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-first">Array#first</a> method in CRuby:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">source</span> <span class="n">Array</span><span class="err">#</span><span class="n">first</span>

<span class="n">From</span><span class="o">:</span> <span class="n">array</span><span class="p">.</span><span class="n">c</span> <span class="p">(</span><span class="n">C</span> <span class="n">Method</span><span class="p">)</span><span class="o">:</span>
<span class="n">Owner</span><span class="o">:</span> <span class="n">Array</span>
<span class="n">Visibility</span><span class="o">:</span> <span class="n">public</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="o">:</span> <span class="mi">11</span>

<span class="k">static</span> <span class="n">VALUE</span> <span class="n">rb_ary_first</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">VALUE</span> <span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">ary</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">Qnil</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">RARRAY_AREF</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">ary_take_first_or_last</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">ary</span><span class="p">,</span> <span class="n">ARY_TAKE_FIRST</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>As you can see, both of these functions have a lot of similarities. They take the same values in each and they both return a <a href="http://stabbyproc.com/ruby/value-pointer-in-cruby.html">VALUE pointer</a>, which represents the new array value returned from the function. These methods also check to make sure that the array length is greater than zero, otherwise <code class="highlighter-rouge">Qnil</code> is returned. Finally, both functions are similar in that they call the <code class="highlighter-rouge">ary_take_first_or_last</code> method if the array wants to return more than just one object from the list. However, before I talk about that function I want to cover how each method returns a single object from either the front or the end of the array.</p>

<p>In <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-first">Array#first</a> the method first checks to see if the <a href="http://crasseux.com/books/ctutorial/argc-and-argv.html">argc</a> variable is equal to 0. That means that the Ruby program doesn’t want to return anything more than the first value from the array. Afterwards, the function checks to see if the length of the array is greater than zero. If it’s not, then the function returns the nil value, <code class="highlighter-rouge">Qnil</code>. If the array length is greater than zero though, then the function calls to <code class="highlighter-rouge">RARRAY_AREF</code> with the array and value that needs to be returned. In this case, that value is 0 because we want the first element in the array.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c">  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">Qnil</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">RARRAY_AREF</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span></code></pre></figure>

<p>The functionality is very similar when working with <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-last">Array#last</a>. The only difference is the value that needs to be returned from the array. I found this part of the function very interesting because I was wondering how C arrays would handle returning the last value from an array, since there’s no natural way for the data structure to do so. However, in CRuby, we leverage the <code class="highlighter-rouge">RArray</code> structure variable, <code class="highlighter-rouge">len</code>, which holds the Ruby array’s length. Finally, we pass this along to the <code class="highlighter-rouge">RARRAY_AREF</code> function where the single value is returned.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c">  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">RARRAY_LEN</span><span class="p">(</span><span class="n">ary</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">Qnil</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">RARRAY_AREF</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span></code></pre></figure>

<p><code class="highlighter-rouge">RARRAY_AREF</code> is a preprocessor function which returns an array value based on the <code class="highlighter-rouge">i</code> input variable. You can see this in the code below because of the square brackets and reference to the <code class="highlighter-rouge">RARRAY_CONST_PTR</code> function. This function returns the constant <code class="highlighter-rouge">VALUE</code> pointer to the <code class="highlighter-rouge">RArray</code> structure passed into the function and using the brackets means that we are returning an array with a single value back to Ruby.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c">  <span class="cp">#ifndef RARRAY_AREF
</span>  <span class="cp"># define RARRAY_AREF(a, i) (RARRAY_CONST_PTR(a)[i])
</span>  <span class="cp">#endif</span></code></pre></figure>

<p>And that’s it. Both <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-first">Array#first</a> and <a href="https://ruby-doc.org/core-2.4.0/Array.html#method-i-last">Array#last</a> pass their functionality to this function in order to return the necessary value from the array. In the next post I will cover how both these Ruby functions return multiple values from the array, including an in depth look at the <code class="highlighter-rouge">ary_take_first_or_last</code> function.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ruby/value-pointer-in-cruby.html">
        What's VALUE in CRuby?
      </a>
    </h1>

    <sub class="article-date">Feb-20-2017</sub>
    <p>Before I talk about CRuby, I want to briefly discuss what the VALUE pointer is. Understanding what this pointer does will help when looking through <a href="https://docs.ruby-lang.org/en/trunk/extension_rdoc.html">CRuby source code</a>. One great benefit about C is that every value and function must specifically declare the datatype that it’s working with. I find this super helpful when trying to investigate what something does in C code. By using this, it’s possible to determine the value type that the function uses, and what each parameter is before it’s used. This is different from Ruby or other dynamically typed languages, <a href="http://www.rubyfleebie.com/ruby-is-dynamically-and-strongly-typed/">where a function or variable data type is determined at runtime</a>. While this is helpful when you’re working with objects that don’t have a specific data type, in my opinion I prefer the declared value type as it makes the code easier to read and understand.</p>

<p>When I inspect C code, I always try to identify the data type to better understand what’s going on. The only problem with inspecting CRuby source code though, was I kept running into this VALUE data type:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">VALUE</span> <span class="nf">example_func</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">arg_object</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">VALUE</span> <span class="n">var</span> <span class="o">=</span> <span class="n">another_example_func</span><span class="p">(</span><span class="n">arg_object</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">var</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>What’s this data type and how can I use it to better understand the CRuby source code? As I thought about this dilemma, I remembered reading about VALUE in a book I finished a while back, <a href="http://mgm702.com/books.html">Ruby Under a Microscope</a>. In this book the author, <a href="http://www.rubyinside.com/">Pat Shaughnessy</a>, describes VALUE as a pointer to any RClass or RObject value in Ruby. In CRuby, these structures are used to hold resources and information about objects or classes such as the instance variable count, <a href="http://inferior-products.com/docs/userdocs/ruby19/html/d7/da9/struct_r_object.html">numiv</a>, or a pointer to an array of instance variables, <a href="http://inferior-products.com/docs/userdocs/ruby19/html/d7/da9/struct_r_object.html">ivptr</a>. RClass and RObject structures also contain an inner structure called RBasic which holds additional information about the object, most importantly the <a href="http://inferior-products.com/docs/userdocs/ruby19/html/d7/da9/struct_r_object.html">klass pointer</a>. All of these are used by Ruby to help build object and class templates.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">struct</span> <span class="n">RObject</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">RBasic</span> <span class="n">basic</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="kt">uint32_t</span> <span class="n">numiv</span><span class="p">;</span>
	    <span class="n">VALUE</span> <span class="o">*</span><span class="n">ivptr</span><span class="p">;</span>
            <span class="kt">void</span> <span class="o">*</span><span class="n">iv_index_tbl</span><span class="p">;</span> <span class="cm">/* shortcut for RCLASS_IV_INDEX_TBL(rb_obj_class(obj)) */</span>
	<span class="p">}</span> <span class="n">heap</span><span class="p">;</span>
	<span class="n">VALUE</span> <span class="n">ary</span><span class="p">[</span><span class="n">ROBJECT_EMBED_LEN_MAX</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">as</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Another interesting fact about VALUE is how it’s represented internally by CRuby. While most of the time using a pointer data type would be the best solution, instead VALUE is represented as an unsigned long. Because on most computer platforms, <code class="highlighter-rouge">sizeof(void *)</code> is equal to <code class="highlighter-rouge">sizeof(long)</code>, this representation is not an issue. The main purpose of the pointer continues to be holding the memory address of the structure on the heap, however, by using the unsigned long data type, Ruby is able to leverage performance benefits. Smaller data types such as <a href="http://archive.oreilly.com/pub/post/the_ruby_value_1.html">nil, symbols, true, false, and small integers are saved directly to VALUE</a>. Ruby remembers these classes using a series of bit flags saved in the first few bits of VALUE. This means that these classes are saved on the stack instead of the normal place where CRuby stores them, the heap.</p>

<p><span class="">
  <img src="http://i1368.photobucket.com/albums/ag177/Matt_Michnal/2__ruby_zps51pby4fp.png">
</span></p>

<p>When working with objects in Ruby, other than the smaller class types, the VALUE pointer is used as a reference to CRuby class data structures. Because information in objects has a longer lifespan and more complicated data, the actual data structure is saved on the heap and then VALUE is used to hold its memory address. When the VALUE is no longer referenced in Ruby code, it will remove the memory address from storage, making the structure on the heap ready for garbage collection. This is illustrated below with a simple RObject structure:</p>

<p><span class="">
  <img src="http://i1368.photobucket.com/albums/ag177/Matt_Michnal/heapstack_zpsa0yqblmn.png">
</span></p>

<p>I hope this information helps when trying to follow <a href="http://stabbyproc.com/tags/#cruby">my series of CRuby source code posts</a>!</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ruby/tools-being-used-for-c-ruby-inspection.html">
        Tools I'm Using to Inspect CRuby Source Code
      </a>
    </h1>

    <sub class="article-date">Feb-17-2017</sub>
    <p>This is a short post about the tools that I’m going to use to investigate methods in the <a href="http://ruby-doc.org/">CRuby source code</a>. Hopefully using these same techniques, if you feel like it, you can follow along as you read through this <a href="http://stabbyproc.com/tags#cruby">series of posts</a>. With better understanding of the tools that I’m going to be using, you will be better equipped to understand the <a href="http://ruby-doc.org/">CRuby source code</a>.</p>

<p><span class="mr-miyagi">
  <img src="http://i.giphy.com/s2Llqyba674pW.gif">
</span></p>

<p>The main tool that I’m going to talk about is <a href="http://pryrepl.org/">Pry</a>. Many developers already know about this tool, especially if you work in Ruby codebases frequently. It’s often used as a <a href="https://learn.co/lessons/debugging-with-pry">runtime debugger</a> and it’s an amazing tool for taking apart your stack trace method by method until you’ve found the source of your problems. However, the part of <a href="http://pryrepl.org">Pry</a> that I’m going to talk about is the less recognized part of the gem which is the <a href="https://github.com/pry/pry/wiki/Source-browsing">show-source</a> method found inside the <a href="https://www.sitepoint.com/rubyists-time-pry-irb/">Pry REPL console</a>.</p>

<p>Pry not only can be used as a <a href="https://learn.co/lessons/debugging-with-pry">powerful Ruby debugging tool</a>, it can also be used to bring up CRuby source code methods that power the language methods being used. This feature is one of my favorite parts about Pry; however, when I talk to other developers about this functionality, they often times have had very little experience actually using the tool.</p>

<div class="big-emoji">
<img class="emoji" title=":fearful:" alt=":fearful:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f628.png" height="20" width="20" align="absmiddle">
</div>

<p>In order to use Pry’s <a href="https://github.com/pry/pry/wiki/Source-browsing">show-source</a> method, the heart of our inspection process, we need to use the Pry REPL instance. In order to get this set up we first must install the pry gem to our system:</p>

<p><code class="highlighter-rouge">gem install pry</code></p>

<p>Now that pry is installed it’s possible to open the Pry REPL console by simply typing <code class="highlighter-rouge">pry</code> into your terminal. The instance that opens is similar to the traditional IRB REPL console that comes with Ruby; however this instance provides Pry specific functions that help with the inspection of CRuby code, particularly the <a href="https://github.com/pry/pry/wiki/Source-browsing">show-source</a> function. The basics of using the <a href="https://github.com/pry/pry/wiki/Source-browsing">show-source</a> function are pretty simple, just enter <code class="highlighter-rouge">show-source</code> followed by the Class and the method that you’re looking to find. An example of this is shown below looking for the <a href="https://ruby-doc.org/core-2.4.0/String.html#method-i-scan">String#scan</a> method.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">source</span> <span class="n">String</span><span class="err">#</span><span class="n">scan</span>

<span class="n">From</span><span class="o">:</span> <span class="n">string</span><span class="p">.</span><span class="n">c</span> <span class="p">(</span><span class="n">C</span> <span class="n">Method</span><span class="p">)</span><span class="o">:</span>
<span class="n">Owner</span><span class="o">:</span> <span class="n">String</span>
<span class="n">Visibility</span><span class="o">:</span> <span class="n">public</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="o">:</span> <span class="mi">31</span>

<span class="k">static</span> <span class="n">VALUE</span>
<span class="n">rb_str_scan</span><span class="p">(</span><span class="n">VALUE</span> <span class="n">str</span><span class="p">,</span> <span class="n">VALUE</span> <span class="n">pat</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">VALUE</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">last</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">RSTRING_PTR</span><span class="p">(</span><span class="n">str</span><span class="p">);</span> <span class="kt">long</span> <span class="n">len</span> <span class="o">=</span> <span class="n">RSTRING_LEN</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>

    <span class="n">pat</span> <span class="o">=</span> <span class="n">get_pat_quoted</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">mustnot_broken</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rb_block_given_p</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">VALUE</span> <span class="n">ary</span> <span class="o">=</span> <span class="n">rb_ary_new</span><span class="p">();</span>

        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">NIL_P</span><span class="p">(</span><span class="n">result</span> <span class="o">=</span> <span class="n">scan_once</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">)))</span> <span class="p">{</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">prev</span><span class="p">;</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
            <span class="n">rb_ary_push</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">rb_pat_search</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ary</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">NIL_P</span><span class="p">(</span><span class="n">result</span> <span class="o">=</span> <span class="n">scan_once</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">prev</span><span class="p">;</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
        <span class="n">rb_yield</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="n">str_mod_check</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">rb_pat_search</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>This example provides us with a basic idea of how the C source code method is setup in Ruby; however in order to fully understand this method and all of the data structures and methods that go with it, we need to open up CRuby files and inspect them for ourselves. In addition to opening these files, we need a way to index those methods and data structures so that we can easily jump back and forth between method and structure defintions to better understand the underlying CRuby source code. To accomplish this, I’ll be using <a href="https://github.com/postmodern/ruby-install">ruby-install</a>, <a href="https://github.com/postmodern/chruby">chruby</a>, and <a href="http://ctags.sourceforge.net/">ctags</a> to load, organize, and index my Ruby source code for inspection. Hopefully this post was able to give you an idea of how I plan on looking through the CRuby source code. If you feel inclined you can now join along as I start my journey with my favorite data structure in programming, the Array.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ruby/intro-learning-c-through-ruby.html">
        Deep Dive Into CRuby Source Code - A Fun Experiment in Learning
      </a>
    </h1>

    <sub class="article-date">Feb-15-2017</sub>
    <p>I’ve been working with a lot of C code lately and it’s amazing!</p>

<div class="big-emoji">
 <img class="emoji" title=":scream:" alt=":scream:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f631.png" height="20" width="20" align="absmiddle">
</div>

<p>I started with the modest goal of learning to read the <a href="http://ruby-doc.org/core-2.4.0/GC.html">garbage collector code in CRuby</a> and it spiraled out of control from there. So many projects are built on top of C. It’s one of those programming languages that’s hard to avoid, especially if you’re working on system level software such as <a href="https://redis.io/">Redis</a>, or my favorite tool of all <a href="http://www.vim.org/">Vim</a>. Since that’s the kind of code I like to create, I felt what better time to start learning how to program in C.</p>

<p><span class="cat-dog">
  <img src="http://i.giphy.com/RGCRb4qZ1zA6A.gif">
</span></p>

<p>So a little background on me before I begin. During my last year and a half of college, I took <a href="http://www.cplusplus.com/">C++</a> programming courses. They were some of the toughest classes that I’d ever taken, but I learned a lot of the practices of coding that I still try to follow today. Having this knowledge in <a href="http://www.cplusplus.com/">C++</a> definitely helped me learn how to program in C, since the only noticeable difference between the two is the function-driven vs. object-driven nature of each language. Now I know that all of the language purists will probably read this and complain because there are other differences between the two languages, but I’m just pointing out the most noticeable difference between the two. Since I mostly work in Ruby, I felt comfortable working in Object Oriented code architecture, so I was excited to try something new, and with C code I was that much closer to actually communicating with the machine.</p>

<p><span class="beavis-computer">
  <img src="http://i.giphy.com/MF1kR4YmC2Z20.gif">
</span></p>

<p>I dove head first into <a href="http://mgm702.com/books">reading books about C programming</a> to learn the best practices of the language. All of this was fascinating and I learned so much about how C has influenced so many programming languages, and how it still remains a powerful language for creating software after all of these years. The biggest pain points in learning C was wrapping my head around pointers again and using them more than ever to move and shape data in my code. A good resource that I found that helped me with many of the subtleties of using pointers was <a href="http://amzn.to/2mReVzT">Understanding and Using C Pointers</a>. This book was incredibly helpful with learning <a href="https://www.quora.com/What-are-the-different-types-of-C-pointers">double and dangling pointers</a>, both of which I had struggled with before finding this resource. After finishing <a href="http://amzn.to/2mReVzT">Understanding and Using C Pointers</a> it was time to try to solidify the knowledge that I had recently acquired, but how could I do that?</p>

<p>I decided to turn to the original reason that I started learning C code in the first place, to understand the <a href="http://ruby-doc.org/core-2.4.0/GC.html">MRI garbage collector source code</a>. This time however, I have bigger ambitions than just understanding <a href="http://ruby-doc.org/core-2.4.0/GC.html">Ruby’s GC code</a>. I now can use my better understanding of C code to help me better grasp the underlying concepts that make up the Ruby programming language. Therefore, in this series of posts, I will describe different methods in Ruby and how they work underneath the surface using C code. Some of it will be simple concepts used to illustrate C’s influence on the Ruby language and some of them will be more complex in order to try and understand the lower level methods that help make Ruby the amazing programming language it is today.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ubuntu/personal-server-setup.html">
        Creating a Personal Git Server From Your Old Computer
      </a>
    </h1>

    <sub class="article-date">Feb-02-2017</sub>
    <p>Recently, I’ve been looking for a new solution to hold my private git repositories. I know some people will say to use <a href="https://bitbucket.org/">Bitbucket</a> or <a href="https://about.gitlab.com/">Gitlab</a>, because they have free private repos and they’re amazing! And sure it’s true that they have great services that provide git management for you to use as you please, but the problem is that I wanted something that I could not only manage at the system level, but I  also wanted a solution that was independent and customizable. I debated the idea of using <a href="https://www.digitalocean.com/">Digital Ocean</a>, <a href="https://aws.amazon.com/">AWS</a> or <a href="https://www.heroku.com/">Heroku</a> to host my personal solution, but the money it would take to create a complete management tool made me think about how I could solve this problem while keeping my costs down. In addition to the price factor, a major point of emphasis for me was to have full control over the server and all of its components. Finally, my last goal with this server was to use <a href="https://www.docker.com/">Docker</a> to create and manage my technology stack, so I wanted to create something on my own. Around this time I was cleaning out part of my house, and what do I happen to find but my old <a href="https://www.amazon.com/Dell-15-6-Inch-Processor-Discontinued-Manufacturer/dp/B002PY7OSA">Dell</a> computer. This computer is nothing special but it does have the following specs:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="nl">Architecture:</span>          <span class="n">x86_64</span>
<span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">:</span>                <span class="mi">2</span>
<span class="n">Model</span> <span class="n">name</span><span class="o">:</span>            <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span><span class="mi">2</span> <span class="n">Duo</span> <span class="n">CPU</span>     <span class="n">T6600</span>  <span class="err">@</span> <span class="mi">2</span><span class="p">.</span><span class="mi">20</span><span class="n">GHz</span>
<span class="n">HDD</span><span class="o">:</span>                   <span class="mi">320</span><span class="n">GB</span>
<span class="n">RAM</span><span class="o">:</span>                   <span class="mi">4096</span><span class="n">MB</span>
<span class="n">Type</span><span class="o">:</span>                  <span class="n">DDR2</span></code></pre></figure>

<p>Definitely not anything I would brag about or use for my primary development machine, but it still has value to me, and I didn’t want to get rid of it just yet. So I thought to myself, why not try an older approach and configure my own home server that can run on <a href="https://www.docker.com">Docker</a> and use the <a href="https://about.gitlab.com/">Gitlab CE</a> open source tool to manage my git repos? I could also create other small utility sites that would turn this once dust collecting relic into a fully functional system that my family and I could use for our storage needs. I began thinking about what exactly I wanted on this home server of mine.</p>

<p>I wanted to use a Linux server setup that was stable and could get up and running relatively quickly. I decided to use an Ubuntu Server version 16.04 image. I wanted to use the latest version of the distro, and I wanted to make sure that <a href="https://www.docker.com">Docker</a> was the main focus of tool management on the server. However, I also wanted the availability and familiarity of an Ubuntu server, since it’s the distro I’m most comfortable with. I could’ve went with <a href="https://www.debian.org/">Debian</a> as well, but for now I decided on <a href="https://www.ubuntu.com/">Ubuntu</a>. In the future, as I get better with <a href="https://www.docker.com">Docker</a> I will probably move to <a href="https://coreos.com/">CoreOS</a> since it’s size is <a href="https://thenewstack.io/digital-ocean-now-supports-coreos-the-lightweight-linux-distro-for-hosting-docker-containers/">1/4</a> that of a normal Linux distro. Also, <a href="https://www.coreos.com">CoreOS</a> provides tools that assist in managing multiple server container systems at once. This might be useful if my girlfriend ever decides to give up her old Macbook for the good of our server farm <img class="emoji" title=":joy:" alt=":joy:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f602.png" height="20" width="20" align="absmiddle">.</p>

<p>The technology stack that I want to use on this server varies since I plan to use the server as a small project test space, in addition to it’s use as a git repository management tool and media client server. However, the main technology I’ll be focusing on is the following:</p>

<ul>
  <li><a href="http://rubyonrails.org/">Ruby/Rails</a></li>
  <li><a href="http://puma.io/">Puma Server</a></li>
  <li><a href="http://www.sinatrarb.com/">Sinatra (small API apps)</a></li>
  <li><a href="https://www.nginx.com/">Nginx</a></li>
  <li><a href="https://www.postgresql.org/">PostgreSQL</a></li>
</ul>

<p>After sorting out all of the configurations that I wanted setup in my head, I was finally ready to start developing this server. With any good project though, I needed to first test everything to make sure it was going to work the way I expected it to. This is when I decided to turn to one of my favorite development tools, <a href="https://www.virtualbox.org/">Virtualbox</a>. I’ll talk more about that though in the next post, but that’s all for right now.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/vim/organize-vimrc-setup.html">
        Organizing Your Vimrc Into Multiple Files
      </a>
    </h1>

    <sub class="article-date">Dec-02-2016</sub>
    <p>This post is about splitting up your vimrc file into smaller more manageable systems. <a href="https://github.com/mgm702/dotfiles/tree/master/vim">My vimrc</a> is easier to organize using this layout, and it allows me to add or remove settings and plugins at will. This is useful when you’re constantly updating and changing your vimrc settings. Sometimes I’ll look through <a href="https://dougblack.io/words/a-good-vimrc.html">popular vimrc files</a> for new and interesting methods or settings to incorporate into my setup that allow me to make quick additions or subtractions.</p>

<p>The first part of setting up a more dynamic vim setup is expanding and sourcing in files into your primary vimrc file. This allows you to break up a large vimrc file into smaller parts that you then control whether they’re sourced into your setup or not. Also, breaking up the file into more modular components allows you to understand parts of the vim setup more easily and quickly. No longer do you have to wonder if the settings you added to your vimrc are meant for a plugin or not, just <a href="https://github.com/mgm702/dotfiles/tree/master/vim/settings">create a new specific plugin file for those settings</a> and source it in. This gives amazing flexibility to the vim configuration system; however, sourcing in vim files can also be dangerous if not well-contained. You don’t want to source a file into your vimrc if it doesn’t exist or is in the incorrect location on your system.</p>

<p>The important component in making this possible is the <code class="highlighter-rouge">filereadable</code> method, which, with the help of the expand method, test a certain path to see if the file actually exists in that location. If it does, then the next step is to <code class="highlighter-rouge">source</code> in the file so it can be used by <a href="https://github.com/mgm702/dotfiles/tree/master/vim">my vimrc</a>:</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">if</span> filereadable<span class="p">(</span>expand<span class="p">(</span><span class="s2">"~/.vim/plugins.vim"</span><span class="p">))</span>
  source <span class="p">~</span><span class="sr">/.vim/</span>plugins<span class="p">.</span><span class="k">vim</span>
<span class="k">endif</span>

<span class="k">if</span> filereadable<span class="p">(</span>expand<span class="p">(</span><span class="s2">"~/.vim/settings.vim"</span><span class="p">))</span>
  source <span class="p">~</span><span class="sr">/.vim/</span>settings<span class="p">.</span><span class="k">vim</span>
<span class="k">endif</span></code></pre></figure>

<p>The benefit of this is that if the file isn’t found on the system, then the vimrc file doesn’t try to source in a file which doesn’t exist where it should be on your computer. This is helpful because if your vimrc tried to source in the file without this safeguard, it would throw an error and everything would blow up!</p>

<p><span class="">
  <img src="https://media.giphy.com/media/xuDHhHcCR0rew/giphy.gif">
</span></p>

<p>The first thing that I like to organize in <a href="https://github.com/mgm702/dotfiles/tree/master/vim/plugins">my vim setup is my plugins</a>. I work with a variety of languages and I like my plugins to be organized based on my needs during development. The plugin manager I use to install and setup the necessary plugins is <a href="https://github.com/junegunn/vim-plug">vim-plug</a>. This is an amazing tool and you should seriously check it out if you want to <a href="https://github.com/junegunn/vim-plug">leverage on-demand loading</a> for your vim plugins. This helped me greatly reduce my startup time, and it still allows me to work with all my favorite tools in whatever language I choose.</p>

<p>That’s why in the first couple of lines in my <code class="highlighter-rouge">plugins.vim</code> file I focus on loading and configuring <a href="https://github.com/junegunn/vim-plug">vim-plug</a> to help manage my plugins. After that is installed and set up, I change the runtime path, or <code class="highlighter-rouge">rtp</code>, so that vim is able to find all of the plugins pages located in the <code class="highlighter-rouge">plugins</code> directory that I organize based on need and language. This configuration allows me to add and remove plugins quickly based on necessity at the moment. An example of this can be found below where I have commented out the <code class="highlighter-rouge">status_line.plugins</code> file because I’m <a href="https://github.com/mgm702/dotfiles/blob/master/vim/settings/status_line.vim">currently using a simple status line instead</a>.</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="c">" Load vim-plug</span>
<span class="k">if</span> empty<span class="p">(</span>glob<span class="p">(</span><span class="s2">"~/.vim/autoload/plug.vim"</span><span class="p">))</span>
  execute <span class="s1">'!curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'</span>
<span class="k">endif</span>

<span class="k">call</span> plug#begin<span class="p">(</span><span class="s1">'~/.vim/bundle'</span><span class="p">)</span>

<span class="k">set</span> rtp<span class="p">+=~</span><span class="sr">/.vim/</span>plugins/

runtime <span class="k">ruby</span><span class="p">.</span>plugins
runtime autocomplete<span class="p">.</span>plugins
runtime git<span class="p">.</span>plugins
runtime php<span class="p">.</span>plugins
runtime project<span class="p">.</span>plugins
runtime html<span class="p">.</span>plugins
runtime js<span class="p">.</span>plugins
runtime css<span class="p">.</span>plugins
runtime <span class="k">c</span><span class="p">.</span>plugins
runtime <span class="k">go</span><span class="p">.</span>plugins
runtime <span class="k">c</span><span class="p">.</span>plugins
<span class="c">" runtime status_line.plugins</span>

<span class="k">call</span> plug#<span class="k">end</span><span class="p">()</span></code></pre></figure>

<p>After the plugins are in place, the next thing that I focus on is loading in the vim settings files. I do this by creating a <a href="https://github.com/mgm702/dotfiles/tree/master/vim/settings">settings directory</a> which will hold the smaller, more manageable files such as search, folding, and indentation settings. Then I use a <code class="highlighter-rouge">for</code> loop with the <code class="highlighter-rouge">globpath</code> method, which expands the directory and returns an array of files inside that directory, to find each file in the settings directory. Finally a call to source the file is executed and each of the settings are loaded into my vim configuration.</p>

<figure class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">let</span> vimsettings <span class="p">=</span> <span class="s1">'~/.vim/settings'</span>
<span class="k">let</span> uname <span class="p">=</span> system<span class="p">(</span><span class="s2">"uname -s"</span><span class="p">)</span>

<span class="k">for</span> fpath <span class="k">in</span> split<span class="p">(</span>globpath<span class="p">(</span>vimsettings<span class="p">,</span> <span class="s1">'\*.vim'</span><span class="p">),</span> <span class="s1">'\n'</span><span class="p">)</span>
  exe <span class="s1">'source'</span> fpath
<span class="k">endfor</span></code></pre></figure>

<p>And finally you’re ready to go. Now you have a vim setup that is flexible and can adjust based on the language you’re using for development. I hope this setup works for you because it has been a huge benefit for me for a long time. Being able to change and adapt is one of the reasons I love using Vim, and creating my setup like this reflects that. In the next post I will talk more about vim-plug and how I used that among other techniques to solve my vim loading speed problem.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/vim/my-vimrc-setup.html">
        A Look at my Vimrc Setup
      </a>
    </h1>

    <sub class="article-date">Nov-23-2016</sub>
    <p>My favorite software project/tool that I’ve used in my time working with computers is without a doubt <a href="http://www.vim.org/">Vim</a>. This small, but powerful text editor is not only simple in its design and purpose, but it’s also a testament to how a well developed and designed tool will stand the test of time. As I’m writing this post, Vim is now celebrating <a href="https://opensource.com/life/16/11/happy-birthday-vim-25">25 years</a> of being a successful open source project, and it can be found on almost every unix computer around the world. <a href="http://www.vim.org/">Vim</a> allows you to use commands to quickly edit and create text/code with little effort and movement from the keyboard. It’s a developer’s dream tool, and once you’ve conquered the <a href="https://robots.thoughtbot.com/the-vim-learning-curve-is-a-myth">initial hurdle it takes to get comfortable with the editor</a>, you will quickly discover that there’s no going back to the text editor you used before you tried <a href="http://www.vim.org/">Vim</a>.</p>

<p><span class="">
  <img src="https://media.giphy.com/media/26gYL5WTYK4OX1QIw/giphy.gif">
</span></p>

<p>This powerful tool has helped me develop exceptional software for the past couple of years and I wanted to take a moment to talk about the most important part of Vim and that’s <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/00.html">the vimrc file</a>. For many users of the text editor, this file is symbolic of their own custom configurations being included in Vim. With this file you can specifically set up how you want Vim to behave and function while using the tool. It’s a powerful file that <a href="http://stevelosh.com/blog/2010/09/coming-home-to-vim/">many people have written blog posts about</a> and it’s frequently discussed by many <a href="http://www.vim.org/">Vim</a> users. That’s why in this series of posts I’m going to highlight some of the more interesting parts of <a href="https://github.com/mgm702/dotfiles/blob/master/vim/vimrc">my vimrc file</a>. And although there are many <a href="http://stevelosh.com/blog/2010/09/coming-home-to-vim/">other vimrc configurations out there</a>, these are the ones that seem to work for me. So feel free to use any of the settings at your leisure or peril.</p>

<div class="github-card">
  <a href="https://github.com/mgm702/dotfiles">
    <i class="devicon-github-plain-wordmark colored devicon"></i>
    <span class="github-card-text">Mgm702 - Dotfiles</span><i class="fa fa-github-square" aria-hidden="true"></i>
  </a>
</div>

<p>The two main parts of <a href="https://github.com/mgm702/dotfiles/blob/master/vim/vimrc">my vimrc file</a> that I’m going to focus on is splitting settings up into smaller more manageable files and how to solve vim loading speed problems using vim-plug and other techniques. By following these techniques, I’ve been able to create a flexible and dependable configuration. I’m constantly tweaking and correcting my vimrc file for better efficiency and speed because I use this tool very often in my developer workflow. Hopefully these posts will give someone who is looking to use vim as a text editor a useful resource for better managing their vimrc file.</p>

<p>So let’s get started with how to <a href="http://stabbyproc.com/tags/#vimrc">split the vimrc into more manageable parts</a>!</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/vagrant/how-to-fix-permissions-issue-in-vagrant.html">
        How To Fix Permissions Issue In Vagrant
      </a>
    </h1>

    <sub class="article-date">Jul-25-2016</sub>
    <p>While working for <a href="http://www.aimmedia.com/">Active Interest Media</a>, I created a <a href="https://www.vagrantup.com/">Vagrant Box</a> in order to help with on-boarding new developers. The goal was to create a specialized environment that, not only closely mimicked the company’s production environment on <a href="https://aws.amazon.com/">Amazon Web Services</a>, but also created a way for developers on different OS systems to quickly contribute to the codebase. Because many of the company’s developers worked on Windows and Unix machines, this was a major problem that I was looking to solve.</p>

<p>Most of the process was pretty straightforward and I was able to create a <a href="https://en.wikipedia.org/wiki/LAMP_(software_bundle)">LAMP stack box</a> with a mixture of <a href="https://www.chef.io/chef/">Chef</a> and bash commands. Everything was set up and working on different OS environments successfully, but when I tried a simple write process to one of our site’s files on the box, it froze.</p>

<div class="big-emoji">
<img class="emoji" title=":flushed:" alt=":flushed:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f633.png" height="20" width="20" align="absmiddle">
</div>

<p>Why won’t it write to the system, what’s wrong with my perfect Vagrant box? After a little bit of poking around inside the virtual machine, I was able to conclude that the <a href="https://httpd.apache.org/">Apache</a> web root directory, which holds the servable websites on the system, needed to be owned by the <a href="http://fideloper.com/user-group-permissions-chmod-apache">www-data group</a>. I made the changes to the directory on the virtual machine and thought that I had fixed the issue; however, once again, I went to write to the file on the server, and again I was denied.</p>

<p><span class="jurassic-park">
<img src="http://i.imgur.com/pwg9kid.gif">
</span></p>

<p>Why won’t this work, it can’t be the same issue again can it? Sure enough the box had reverted the read/write access to the vagrant user and I was back to square one.</p>

<p>So I dove back into researching this problem, and I found that read/write permissions for the directory could be controlled inside the Vagrantfile. I made the following changes to the file:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"./sites"</span><span class="p">,</span> <span class="s2">"/var/www"</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">"www-data"</span><span class="p">,</span> <span class="ss">:mount_options</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'dmode=775'</span><span class="p">,</span><span class="s1">'fmode=664'</span><span class="p">]</span></code></pre></figure>

<p>After these changes, the server was finally running the way I wanted it to. To me this was a lesson in perseverance and testing the changes you assume fix the issue. Hopefully this lesson will save someone else time and effort down the road!</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/ruby/test-omniauth-with-rspec.html">
        Not Quite My Tempo - Testing OmniAuth with RSpec
      </a>
    </h1>

    <sub class="article-date">Jun-21-2016</sub>
    <p>I recently worked on a project that incorporated OmniAuth functionality, and I wanted to ensure that everything was testing properly.</p>

<p>I was using the RSpec and Capybara testing frameworks to test features and user behavior. I normally prefer MiniTest when choosing a testing framework, but hey if it’s not broke why fix it. Anyways, I was put in charge of both the OmniAuth functionality and the testing to make sure that they worked correctly. This is not an easy task because you’re basically simulating a successful sign into a third party platform, plus you have to return info back to your application.</p>

<p>So I began my search online to see if I could find a solution to this problem, however; I found it difficult to find exactly what I was looking for.
<span class="not-tempo">
<img src="https://i.imgur.com/35r8qKs.gif">
</span>
Many solutions had close to what I was looking for, but often times they would be included just once in the test. Also, many examples were only RSpec specific, and that was a problem for me because I wanted a way to easily use OmniAuth anywhere inside the test suite with either RSpec or MiniTest. That is when I came to the conclusion that I could put a support module inside the test suite.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">OmniAuthMock</span>
  <span class="k">class</span> <span class="nc">User</span>
    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
    <span class="k">def</span> <span class="nc">User</span><span class="o">.</span><span class="nf">current_user</span>
      <span class="no">Capybara</span><span class="p">.</span><span class="nf">default_host</span> <span class="o">=</span> <span class="s1">'http://127.0.0.1:3000'</span>
      <span class="no">OmniAuth</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">test_mode</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="no">OmniAuth</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">mock_auth</span><span class="p">[</span><span class="ss">:github</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="ss">provider: </span><span class="s1">'github'</span><span class="p">,</span>
        <span class="ss">uid: </span><span class="s1">'1234567'</span><span class="p">,</span>
        <span class="ss">credentials: </span><span class="p">{</span>
          <span class="ss">token: </span><span class="s1">'3kynje'</span>
        <span class="p">},</span>
        <span class="ss">info: </span><span class="p">{</span>
          <span class="ss">nickname: </span><span class="s1">'jtest'</span><span class="p">,</span>
          <span class="ss">name: </span><span class="s1">'Joe Test'</span><span class="p">,</span>
          <span class="ss">email: </span><span class="s1">'email@email.com'</span><span class="p">,</span>
          <span class="ss">image: </span><span class="s1">'jtest.jpg'</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">visit</span> <span class="s1">'auth/github'</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>This class method then can be used before tests or directly in them if need be. The reason this solution works for me is because it’s very DRY and I don’t have to write out the mock Omniauth object multiple times in the program. That make me <img class="emoji" title=":smile:" alt=":smile:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png" height="20" width="20" align="absmiddle"></p>

<p>Here is an example of the class method being used in a RSpec feature test before statement:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">before</span> <span class="k">do</span>
    <span class="no">OmniAuthMock</span><span class="o">::</span><span class="no">User</span><span class="p">.</span><span class="nf">current_user</span>
  <span class="k">end</span></code></pre></figure>

<p>And here is an example of the class method being directly used in a MiniTest test directly:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="k">def</span> <span class="nf">test_authentication</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">OmniAuthMock</span><span class="o">::</span><span class="no">User</span><span class="p">.</span><span class="nf">current_user</span>
    <span class="n">assert_equal</span> <span class="n">user</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="s2">"Joe Test"</span>
  <span class="k">end</span></code></pre></figure>

<p>I hope this helps anyone who’s out there looking for a nice DRY solution to OmniAuth testing.</p>


    <a class="twitter-follow-button" href="https://twitter.com/mgm702" data-show-count="false">
      Follow @mgm702</a>
    </article>
  
</div>


      </main>

      <footer class="footer">
  <ul class="category-list">
    <li class="category-list">
      <a href="/categories#ruby">Ruby</a>
      <a href="/categories#ubuntu">Ubuntu</a>
      <a href="/categories#vim">Vim</a>
    </li>
  </ul>
  <ul class="archive-list">
    <li class="archive-link">
      <a href="/about">About</a>
      <a href="/archive">Archive</a>
    </li>
  </ul>

  <br>
  <div class="footer-copyright">
    <small>
    © <time datetime="2017-04-05T00:09:50-06:00">2017</time> StabbyProc.com All rights reserved.
    </small>
  </div>
</footer>

<script src="/js/twitter.js" type="text/javascript"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83001023-1', 'auto');
  ga('send', 'pageview');

</script>


    </div>

  

</default></body></html>
